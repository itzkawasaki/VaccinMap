<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hatena.b.search</title>
    <!-- Bootstrap -->
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet">
    <link href="stylesheets/bootstrap.css" rel="stylesheet">
    <link href="stylesheets/bootstrap-responsive.css" rel="stylesheet">
    <link href="stylesheets/bootstrap-responsive.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  </head>
  <body style="padding-top: 50px;">

	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	  <div class="container">
	    <div class="navbar-header">
	      <a class="navbar-brand" href="/">予防接種マップ</a>
	    </div>
	    <div class="navbar-collapse collapse">
	      <div class="navbar-form navbar-right">
	          <div class="input-append">
	              <input id="address" type="textbox" value="横浜駅" class="span3" placeholder="住所から近くの病院を検索">
	              <button class="btn btn-success fa fa-search" href="#"  onclick="codeAddress()"></button>
              </div>
	      </div>
	    </div>
	  </div>
	</div>

    <div class="container">
		<div class="row-fluid">

            <div class="span3 bs-docs-sidebar">
                <h2 class="sub-header">
                     <span></span>
                </h2>
                <div class="well sidebar-nav">
                  <select size='12' style="width:100%" data-bind="options: vaccinList, selectedOptions: inputKeyword"> </select>
                </div>
            </div>

		    <div class="span9">
		        <h2 class="sub-header">
                     <span></span>
                </h2>
			    <div class="">
                    <h2 class="sub-header">
                      <blockquote>
                        <h3 data-bind="text:serchKeyword"> </h3>
                      </blockquote>
                    </h2>
					<div id="map_canvas" style="width:100%; height:300px"></div>

                </div>

                <div class="row-fluid">
					<div class="table-responsive" >
					<table class="table table-striped">
					  <thead>
					    <tr>
					      <th>病院</th>
					      <th>住所</th>
					      <th style="min-width: 100px;">電話</th>
					    </tr>
					  </thead>
					  <tbody data-bind="foreach: items" >
					    <tr>
					      <td data-bind="text:hospital"></td>
					      <td data-bind="text:address"></td>
					      <td>
					           <a data-bind="attr: { href: tel_a, target: '_blank' }">
					               <span data-bind="text:tel"></span>
					           </a>
					      </td>
					    </tr>
					  </tbody>
					</table>
					</div>
				</div>
			</div>
		</div>
	</div>
<script src="javascripts/jquery.js"></script>
<script src="javascripts/bootstrap.min.js"></script>
<script src="javascripts/knockout-3.0.0.js"></script>
<script src="http://maps.google.com/maps/api/js?v=3&sensor=false "type="text/javascript" charset="UTF-8"></script>
<script src="javascripts/sample.js" type="text/javascript"></script>
<script src="javascripts/data.js" type="text/javascript"></script>

<script>
var listVaccin =[];
var listlist=[];
$(document).ready(function(){
	initialize();
});



function Item(data) {
    this.hospital = ko.observable(data.byoin.value);
    this.address = ko.observable(data.address.value);
    this.tel =  ko.observable(data.tel.value);
    this.tel_a =  ko.observable('tel:'+data.tel.value.replace('-',''));
}


function AppViewModel() {
    var self = this;

    self.items = ko.observableArray([]);

    self.vaccinList = ko.observableArray(listVaccin);
    self.inputKeyword = ko.observable("");
    self.serchKeyword = ko.computed(self.inputKeyword)
                                    .extend({ throttle: 800 });


    self.serchKeyword.subscribe(function (val) {
       self.search();
    });
    /*
    self.vaccinList.subscribe(function (val) {
        self.getVaccin();
     });
    */

    self.search = function() {
      var keyword = self.serchKeyword();
      if( keyword == "" ) {
        self.items([]);
        return;
      }

      self.items.removeAll();

      $.getJSON("/b.hatena/"+keyword+".json", function(data) {
          self.items($.map(data, function(item) { return new Item(item) }));
      });
    };

    self.getVaccin = function() {

        $.getJSON("/b.hatena/vaccin.xml", function(data) {
            for (i = 0; i < data.length; i++) {
            	//APIデータを配列にセット
                listVaccin.push(data[i].label.value);
            }
            //取得した配列データをセット
            self.vaccinList(listVaccin);
            //リスト上で１番めをセレクトしておく
            self.inputKeyword(data[0].label.value);
            //self.inputKeyword = ko.observableArray(['']);
        });
      };

    self.search();
    self.getVaccin();
}

$(function(){
   ko.applyBindings(new AppViewModel());
});


</script>

  </body>
</html>